<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœˆå¹´è§„åˆ’è¡¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg-color: #f0f2f5; --container-bg-color: #ffffff; --header-bg-color: #1e293b; --header-text-color: #ffffff;
            --border-color: #e2e8f0; --text-color: #1e293b; --date-number-color: #64748b; --other-month-date-color: #cbd5e0;
            --hover-bg-color: #f1f5f9; --today-bg-color: #e0f2fe; --birthday-bg-color: #fef9c3; --birthday-border-color: #facc15;
            --reminder-color: #1d4ed8; --task-color: #059669; --contact-due-color: #be123c; --button-bg-color: #475569;
            --button-hover-bg-color: #64748b; --wisdom-btn-bg: linear-gradient(45deg, #4338ca, #6d28d9);
            --diet-color: #166534; --diet-bg-color: rgba(22, 163, 74, 0.1);
            --primary-text: #333; --secondary-text: #555; --bg-color: #f8f9fa; --table-bg: #ffffff;
            --header-bg: #f8f9fa; --shadow-color: rgba(0, 0, 0, 0.05); --accent-color: #007bff;
            --level-5-bg: #ffe0e0; --level-5-text: #c0392b; --level-4-bg: #fff0db; --level-4-text: #e67e22;
            --level-3-bg: #e0eaff; --level-3-text: #2980b9; --influence-strong-bg: #d4edda;
            --influence-strong-text: #155724; --influence-normal-bg: #fff3cd; --influence-normal-text: #856404;
            --influence-weak-bg: #f8d7da; --influence-weak-text: #721c24;
            --annoyance-fund-color: #c2410c; /* New color for Annoyance Fund */
        }
        body { font-family: 'Noto Sans SC', sans-serif; background-color: var(--primary-bg-color); color: var(--text-color); margin: 0; padding: 1.5rem; line-height: 1.6; }
        .planner-container { width: 100%; max-width: 1400px; margin: 0 auto; background-color: var(--container-bg-color); border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); overflow: hidden; position: relative; }
        .top-bar { padding: 1rem 1.5rem; background-color: #f8fafc; border-bottom: 1px solid var(--border-color); display: flex; flex-wrap: wrap; gap: 1.5rem; justify-content: space-between; align-items: center; }
        .controls-group { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; }
        .controls-group label { font-size: 0.9rem; font-weight: 500; }
        .controls-group input, .controls-group select, .controls-group button { padding: 0.5rem 0.75rem; border: 1px solid var(--border-color); border-radius: 6px; font-family: inherit; font-size: 0.9rem; }
        .controls-group button { border: none; background-color: var(--button-bg-color); color: white; cursor: pointer; transition: background-color 0.2s; }
        .controls-group button:hover { background-color: var(--button-hover-bg-color); }
        #btn-save-hero, #add-past-friend-btn { background-color: #16a34a; }
        #btn-save-hero:hover, #add-past-friend-btn:hover { background-color: #15803d; }
        .hero-age-display { font-size: 0.9rem; font-weight: 500; color: var(--header-bg-color); background-color: var(--hover-bg-color); padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border-color); margin-left: 0.5rem; }
        .wealth-system { text-align: right; }
        .wealth-system .wealth-item { display: inline-block; margin-left: 1rem; }
        .wealth-system label { font-size: 0.8rem; color: var(--date-number-color); display: block; }
        .wealth-system input { width: 100px; border: none; border-bottom: 1px solid var(--border-color); border-radius: 0; padding: 0.25rem; font-size: 1rem; font-weight: 500; text-align: right; }
        .wealth-system input:focus { outline: none; border-bottom-color: var(--header-bg-color); }
        .wealth-system #net-worth { font-weight: bold; color: #059669; }
        .wealth-system #annoyance-fund { font-weight: bold; color: var(--annoyance-fund-color); padding: 0.25rem; font-size: 1rem; display: inline-block; min-width: 50px; text-align: right; }
        header { padding: 1.5rem 2rem; background: var(--header-bg-color); color: var(--header-text-color); text-align: center; display: flex; justify-content: space-between; align-items: center; }
        header h1 { margin: 0; font-size: 2rem; font-weight: 500; }
        header .nav-buttons button { width: 40px; height: 40px; padding: 0; font-size: 1.2rem; background-color: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 50%;}
        header .nav-buttons button:hover { background-color: rgba(255,255,255,0.2); }
        main { padding: 1rem; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        thead th { font-weight: 500; padding: 1rem 0.5rem; text-align: center; color: var(--header-bg-color); border-bottom: 2px solid var(--border-color); }
        tbody td { height: 160px; border: 1px solid var(--border-color); vertical-align: top; padding: 0; transition: background-color 0.2s; position: relative; }
        tbody td.today { background-color: var(--today-bg-color); }
        tbody td.birthday { background-color: var(--birthday-bg-color); border: 2px solid var(--birthday-border-color); }
        tbody td:hover { background-color: var(--hover-bg-color); }
        .cell-wrapper { display: flex; flex-direction: column; height: 100%; }
        .cell-top { display: flex; justify-content: space-between; align-items: flex-start; padding: 0.5rem; flex-shrink: 0; }
        .daily-wisdom { text-align: left; font-size: 0.7rem; color: #94a3b8; }
        .daily-wisdom .gua-symbol { font-size: 1.2rem; line-height: 1; }
        .date-header { text-align: right; }
        .date-number { font-size: 0.9rem; font-weight: 500; color: var(--date-number-color); }
        .other-month .date-number, .other-month .daily-wisdom { opacity: 0.5; }
        .birthday-tag { font-size: 0.75rem; font-weight: bold; color: #b45309; display: block; }
        .reminders { flex-shrink: 0; max-height: 78px; overflow-y: auto; font-size: 0.75rem; margin: 0 0.5rem; }
        .notes { flex-grow: 1; padding: 0.5rem; font-size: 0.9rem; line-height: 1.5; overflow-y: auto; outline: none; white-space: pre-wrap; }
        .reminders .reminder { display:flex; justify-content: space-between; align-items: center; padding: 2px 5px; border-radius: 4px; margin-top: 2px; }
        .reminders .reminder-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1; }
        .reminder-friend { background-color: rgba(29, 78, 216, 0.1); color: var(--reminder-color); }
        .reminder-task { background-color: rgba(5, 150, 105, 0.1); color: var(--task-color); }
        .reminder-diet { background-color: var(--diet-bg-color); color: var(--diet-color); cursor: help; }
        .delete-reminder-btn { cursor: pointer; margin-left: 8px; font-size: 10px; display: none; }
        .reminders .reminder:hover .delete-reminder-btn { display: inline; }
        .system-section { border-top: 1px solid var(--border-color); }
        .accordion-toggle { width: 100%; background-color: #f8fafc; border: none; border-bottom: 1px solid var(--border-color); padding: 1rem 1.5rem; font-size: 1.1rem; font-weight: 500; text-align: left; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .accordion-toggle:hover { background-color: #f1f5f9; }
        .accordion-toggle::after { content: 'â–¼'; font-size: 0.8rem; transition: transform 0.3s ease; }
        .accordion-toggle.active::after { transform: rotate(180deg); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease, padding 0.5s ease; background-color: #f8fafc; padding: 0 1.5rem; }
        .accordion-content.active { max-height: 10000px; padding: 1.5rem; }
        #add-task-form { display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end; margin-bottom: 1.5rem; }
        #task-backlog-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; }
        .task-card { background-color: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        #btn-schedule-tasks { font-size: 1rem; background: var(--wisdom-btn-bg); flex-grow: 1;}
        .scheduler-controls { display: flex; gap: 1rem; align-items: center; margin-top: 1.5rem; }
        .delete-btn { background-color: #ef4444 !important; }
        .delete-btn:hover { background-color: #dc2626 !important; }
        .main-header { text-align: center; margin-bottom: 30px; }
        .main-header h1 { font-size: 2.5em; font-weight: 700; margin-bottom: 0.2em; color: var(--primary-text);}
        .main-header p { font-size: 1.1em; color: var(--secondary-text); }
        .filter-section { background: var(--table-bg); padding: 25px; margin: 30px 0; border-radius: 12px; box-shadow: 0 8px 30px var(--shadow-color); }
        .filter-section h3 { margin-top: 0; margin-bottom: 15px; font-size: 1.4em; color: var(--primary-text); }
        #searchInput { width: 100%; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; box-sizing: border-box; transition: border-color 0.2s, box-shadow 0.2s; }
        #searchInput:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); }
        .section-title { font-size: 1.8em; font-weight: 700; margin-top: 50px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color); color: var(--primary-text); }
        .table-container { width: 100%; overflow-x: auto; background-color: var(--table-bg); border-radius: 12px; box-shadow: 0 8px 30px var(--shadow-color); -webkit-overflow-scrolling: touch; }
        .contacts-table { width: 100%; border-collapse: collapse; min-width: 1200px; table-layout: auto; }
        .contacts-table th, .contacts-table td { padding: 16px 20px; text-align: left; vertical-align: middle; border-bottom: 1px solid var(--border-color); font-size: 15px; height: auto; }
        .contacts-table td { cursor: text; }
        .contacts-table thead { background-color: var(--header-bg); position: sticky; top: 0; z-index: 10; }
        .contacts-table th { font-weight: 500; color: var(--secondary-text); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; }
        .contacts-table tbody tr { transition: background-color 0.2s ease-in-out; }
        .contacts-table tbody tr:hover { background-color: #f1f3f5; }
        .contacts-table tbody tr:last-child td { border-bottom: none; }
        .role-tag { display: inline-block; padding: 4px 10px; border-radius: 15px; font-size: 13px; font-weight: 500; margin-right: 5px; margin-bottom: 5px; background-color: #e9ecef; color: #495057; }
        .level, .influence { padding: 5px 12px; border-radius: 6px; font-size: 13px; font-weight: 500; text-align: center; display: inline-block; white-space: nowrap; }
        .level-5 { background-color: var(--level-5-bg); color: var(--level-5-text); }
        .level-4 { background-color: var(--level-4-bg); color: var(--level-4-text); }
        .level-3 { background-color: var(--level-3-bg); color: var(--level-3-text); }
        .influence.strong { background-color: var(--influence-strong-bg); color: var(--influence-strong-text); }
        .influence.normal { background-color: var(--influence-normal-bg); color: var(--influence-normal-text); }
        .influence.weak { background-color: var(--influence-weak-bg); color: var(--influence-weak-text); }
        .main-footer { text-align: center; margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--border-color); font-size: 0.9em; color: #999; }
        .toast-notification { position: fixed; bottom: 20px; right: 20px; background-color: #2d3748; color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: translateY(20px); }
        .toast-notification.show { opacity: 1; transform: translateY(0); }
        .custom-tooltip { position: absolute; background-color: #1e293b; color: white; padding: 10px 15px; border-radius: 6px; font-size: 0.85rem; max-width: 320px; z-index: 1001; pointer-events: none; opacity: 0; transition: opacity 0.2s; white-space: pre-wrap; line-height: 1.7; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .custom-tooltip.show { opacity: 1; }
        @media (max-width: 1200px) { .top-bar { flex-direction: column; align-items: stretch; } }
    </style>
</head>
<body>
    <div class="planner-container">
        <div class="top-bar">
            <div class="controls-group"><label for="hero-name">ä¸»äººå…¬:</label><input type="text" id="hero-name" placeholder="å§“å"><label for="hero-birthday">ç”Ÿæ—¥:</label><input type="date" id="hero-birthday"><span id="hero-age-display" class="hero-age-display"></span><button id="btn-save-hero">âœ”ï¸ ä¿å­˜</button></div>
            <div class="controls-group"><label for="date-jumper-text">è·³è½¬è‡³:</label><input type="text" id="date-jumper-text" placeholder="è¾“å…¥æ—¥æœŸ, å¦‚ 2015-6-2"><input type="date" id="date-jumper-picker"><button id="btn-jump-to-date">ğŸš€ è·³è½¬</button></div>
            <div class="wealth-system">
                <div class="wealth-item"><label>èµ„äº§</label><input type="number" id="wealth-assets" placeholder="0"></div>
                <div class="wealth-item"><label>è´Ÿå€º</label><input type="number" id="wealth-liabilities" placeholder="0"></div>
                <div class="wealth-item"><label>æœ¬æœˆç°é‡‘æµ</label><input type="number" id="wealth-cashflow" placeholder="0"></div>
                <div class="wealth-item">
                    <label title="ç”¨æ¥å¤„ç†ä¸å¤ªé¡ºå¿ƒçš„äº‹">ç³Ÿç³•é‡‘ (æœˆç°é‡‘æµ*5%)</label>
                    <span id="annoyance-fund">0.00</span>
                </div>
                <div class="wealth-item"><label>å‡€èµ„äº§</label><span id="net-worth">0</span></div>
            </div>
        </div>
        <header><div class="nav-buttons"><button id="prev-year">Â«</button><button id="prev-month">â€¹</button></div><h1 id="month-year-header"></h1><div class="nav-buttons"><button id="go-to-today">ä»Šæ—¥</button><button id="next-month">â€º</button><button id="next-year">Â»</button></div></header>
        
        <main>
            <table>
                <thead><tr><th>å‘¨ä¸€</th><th>å‘¨äºŒ</th><th>å‘¨ä¸‰</th><th>å‘¨å››</th><th>å‘¨äº”</th><th>å‘¨å…­</th><th>å‘¨æ—¥</th></tr></thead>
                <tbody id="calendar-body"></tbody>
            </table>
        </main>

        <div class="system-section">
            <button class="accordion-toggle">æˆ‘çš„æœ‹å‹åœˆ</button>
            <div class="accordion-content">
                <header class="main-header">
                    <h1>ğŸ™ˆ æœ‹å‹åœˆ</h1>
                    <p>é€šå¾€å¹¸ç¦çš„é“è·¯ï¼Œæ˜¯ä½ æ‰¾åˆ°ä½ æƒ³è®©ä»–å¹¸ç¦çš„é‚£155ä¸ªäººã€‚</p>
                </header>
                <div class="filter-section">
                    <h3>é«˜æ•ˆç­›é€‰</h3>
                    <input type="text" id="searchInput" placeholder="åœ¨æ­¤è¾“å…¥åå­—ã€åŸå¸‚ã€è¡Œä¸šã€çˆ±å¥½ç­‰ä»»æ„å…³é”®è¯è¿›è¡Œç­›é€‰...">
                </div>
                <h2 class="section-title">é»„é‡‘åœˆ (155äºº)</h2>
                <div class="table-container">
                    <table class="contacts-table" id="golden-circle-table">
                        <thead>
                            <tr><th>åå­—</th><th>è§’è‰²</th><th>èŒä¸š</th><th>è¡Œä¸š</th><th>åœ°ç‚¹</th><th>çˆ±å¥½</th><th>ç”Ÿæ—¥</th><th>äº²å¯†ç­‰çº§</th><th>å½±å“åŠ›</th><th>ä»–æœ‰ä»€ä¹ˆèµ„æº</th><th>ä»–è®¤è¯†è°</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <h2 class="section-title">ä¼¼æ°´å¹´å</h2>
                <div class="table-container">
                    <table class="contacts-table" id="past-friends-table">
                        <thead>
                             <tr><th>åå­—</th><th>è§’è‰²</th><th>èŒä¸š</th><th>è¡Œä¸š</th><th>åœ°ç‚¹</th><th>çˆ±å¥½</th><th>ç”Ÿæ—¥</th><th>å…³ç³»è¯´æ˜</th><th>å½±å“åŠ›</th><th>ä»–æœ‰ä»€ä¹ˆèµ„æº</th><th>ä»–æ˜¯è°çš„è´µäºº</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                 <div style="text-align: right; margin-top: 1rem;">
                    <button id="add-past-friend-btn">â• æ·»åŠ ä¼¼æ°´å¹´åè®°å½•</button>
                </div>
                <footer class="main-footer"><p>äººå’Œäººçš„ç¼˜åˆ†å¾ˆå¥‡å¦™ã€‚ä¸æ–­æµåŠ¨çš„äººè„‰åœˆæ‰æ˜¯å¥åº·çš„ã€‚â€”â€” 2025</p></footer>
            </div>
        </div>

        <div class="system-section">
            <button class="accordion-toggle active">ä»»åŠ¡æ  (Task Kiosk)</button>
            <div class="accordion-content active">
                <form id="add-task-form">
                    <input type="text" id="new-task-input" placeholder="!é‡è¦ä»»åŠ¡, ?æ€è€ƒé¢˜, æ—¥å¸¸ä»»åŠ¡ (ç”¨é€—å·éš”å¼€)" required style="flex-grow: 1;">
                    <button type="submit">â• æ‰¹é‡æ·»åŠ </button>
                </form>
                <div id="task-backlog">
                    <h3 style="font-weight: 500; margin-bottom: 1rem;">å¾…åŠåˆ—è¡¨</h3>
                    <div id="task-backlog-container"></div>
                </div>
                <div class="scheduler-controls">
                    <select id="schedule-period">
                        <option value="day">ä¸€å¤©å†… (æŒ‰æ—¶è¾°)</option>
                        <option value="week" selected>ä¸€å‘¨å†… (æŒ‰æ—¥)</option>
                        <option value="month">ä¸€æœˆå†… (æŒ‰æ—¥)</option>
                        <option value="year">ä¸€å¹´å†… (æŒ‰æœˆ)</option>
                    </select>
                    <button id="btn-schedule-tasks">â˜¯ï¸ ä½¿ç”¨æ˜“ç»æ™ºæ…§è‡ªåŠ¨è§„åˆ’</button>
                </div>
            </div>
        </div>
    </div>
    <div id="custom-tooltip-container"></div>

<script>
// =================================================================================
// Life Planner App V6.2 - Architected & Refactored
// =================================================================================
const LifePlannerApp = {};

// --- 1. CONFIG MODULE: All static data and configurations ---
LifePlannerApp.config = {
    STORAGE_KEYS: {
        HERO: 'heroInfo_v1',
        TASKS: 'taskList_v1',
        NOTES: 'plannerNotes_v1',
        FINANCIALS: 'financials_v1',
        PAST_FRIENDS: 'pastFriends_v1'
    },
    I_CHING_DATA: [{n:1,p:"qiÃ¡n",h:"ä·€",t:"åˆ›é€ åŠ›ã€‚çº¯ç²¹çš„é˜³æ€§èƒ½é‡ï¼Œé€‚åˆå¼€å§‹ã€è¡ŒåŠ¨å’Œé¢†å¯¼ã€‚",type:"è¡ŒåŠ¨"},{n:2,p:"kÅ«n",h:"ä·",t:"æ¥å—æ€§ã€‚çº¯ç²¹çš„é˜´æ€§èƒ½é‡ï¼Œé€‚åˆæ”¯æŒã€åŸ¹å…»å’Œè€å¿ƒç­‰å¾…ã€‚",type:"è§„åˆ’"},{n:3,p:"zhÅ«n",h:"ä·‚",t:"åˆç”Ÿå›°éš¾ã€‚å¯åŠ¨è™½éš¾ï¼Œä½†æ½œåŠ›å·¨å¤§ï¼Œéœ€è¦åšæŒã€‚",type:"æŒ‘æˆ˜"},{n:4,p:"mÃ©ng",h:"ä·ƒ",t:"è’™æ˜§ã€‚éœ€è¦å¯è’™å’Œæ•™è‚²ï¼Œä¸å®œé²è½è¡Œäº‹ã€‚",type:"è§„åˆ’"},{n:5,p:"xÅ«",h:"ä·„",t:"ç­‰å¾…ã€‚æ—¶æœºæœªåˆ°ï¼Œéœ€è¦è€å¿ƒå’Œä¿¡å¿ƒã€‚",type:"è§„åˆ’"},{n:6,p:"sÃ²ng",h:"ä·…",t:"å†²çªã€‚æœ‰äº‰è®®ï¼Œæœ€å¥½é¿å…æˆ–å¯»æ±‚è°ƒè§£ã€‚",type:"æŒ‘æˆ˜"},{n:7,p:"shÄ«",h:"ä·†",t:"å†›é˜Ÿã€‚éœ€è¦çºªå¾‹ã€ç»„ç»‡å’Œé¢†å¯¼åŠ›ã€‚",type:"è¡ŒåŠ¨"},{n:8,p:"bÇ",h:"ä·‡",t:"äº²è¿‘ã€‚å›¢ç»“ä¸åˆä½œå¸¦æ¥å¥½è¿ã€‚",type:"å¹³é¡º"},{n:9,p:"xiÇo chÃ¹",h:"ä·ˆ",t:"å°çš„è“„å…»ã€‚æœ‰å°çš„é˜»ç¢ï¼Œä½†å‰æ™¯å…‰æ˜ã€‚",type:"å¹³é¡º"},{n:10,p:"lÇš",h:"ä·‰",t:"å±¥è¡Œã€‚è¡Œä¸ºè°¨æ…ï¼Œå³ä½¿åœ¨å±é™©ä¸­ä¹Ÿèƒ½å‰è¿›ã€‚",type:"æŒ‘æˆ˜"},{n:11,p:"tÃ i",h:"ä·Š",t:"é€šæ³°ã€‚å¤©åœ°äº¤æ³°ï¼Œä¸‡äº‹äº¨é€šï¼Œå’Œè°ã€‚",type:"å¹³é¡º"},{n:12,p:"pÇ",h:"ä·‹",t:"å¦å¡ã€‚å¤©åœ°ä¸äº¤ï¼Œæœ‰éšœç¢ï¼Œéœ€é€€å®ˆã€‚",type:"æŒ‘æˆ˜"},{n:13,p:"tÃ³ng rÃ©n",h:"ä·Œ",t:"ä¸äººååŒã€‚åœ¨å¼€æ”¾ä¸­å¯»æ±‚åˆä½œã€‚",type:"è¡ŒåŠ¨"},{n:14,p:"dÃ  yÇ’u",h:"ä·",t:"å¤§çš„æ‹¥æœ‰ã€‚è°¦é€Šåœ°æ‹¥æœ‰è´¢å¯Œå’ŒæˆåŠŸã€‚",type:"å¹³é¡º"},{n:15,p:"qiÄn",h:"ä·",t:"è°¦é€Šã€‚è°¦è™šä½¿äººè¿›æ­¥ï¼Œå¸¦æ¥å¹³è¡¡ã€‚",type:"è§„åˆ’"},{n:16,p:"yÃ¹",h:"ä·",t:"æ„‰æ‚¦ã€‚é¡ºåº”æ—¶åŠ¿ï¼Œå¸¦æ¥å–œæ‚¦å’Œçƒ­æƒ…ã€‚",type:"å¹³é¡º"},{n:17,p:"suÃ­",h:"ä·",t:"è·Ÿéš¨ã€‚é€‚åº”å˜åŒ–ï¼Œçµæ´»åº”å¯¹ã€‚",type:"å¹³é¡º"},{n:18,p:"gÇ”",h:"ä·‘",t:"æ•´é¥¬ã€‚ä¿®æ­£è¿‡å»çš„é”™è¯¯ï¼Œå¸¦æ¥æ–°ç”Ÿã€‚",type:"æŒ‘æˆ˜"},{n:19,p:"lÃ­n",h:"ä·’",t:"å›ä¸´ã€‚é¢†å¯¼åŠ›å’Œå½±å“åŠ›å¢é•¿çš„æ—¶åˆ»ã€‚",type:"è¡ŒåŠ¨"},{n:20,p:"guÄn",h:"ä·“",t:"è§‚å¯Ÿã€‚å®¡è§†å†…åœ¨å’Œå¤–åœ¨ï¼Œè·å¾—æ›´æ·±çš„ç†è§£ã€‚",type:"è§„åˆ’"},{n:21,p:"shÃ¬ hÃ©",h:"ä·”",t:"å™¬å—‘ã€‚é‡‡å–æœæ–­è¡ŒåŠ¨ï¼Œå…‹æœéšœç¢ã€‚",type:"è¡ŒåŠ¨"},{n:22,p:"bÃ¬",h:"ä·•",t:"è£…é¥°ã€‚ä¼˜é›…å’Œç¾æ„Ÿï¼Œä½†æ³¨é‡å®è´¨ã€‚",type:"å¹³é¡º"},{n:23,p:"bÅ",h:"ä·–",t:"å‰¥è½ã€‚äº‹ç‰©æ­£åœ¨ç“¦è§£ï¼Œä¸å®œè¡ŒåŠ¨ã€‚",type:"æŒ‘æˆ˜"},{n:24,p:"fÃ¹",h:"ä·—",t:"å›å½’ã€‚è½¬æŠ˜ç‚¹ï¼Œé˜³æ°”å›å½’ã€‚",type:"å¹³é¡º"},{n:25,p:"wÃº wÃ ng",h:"ä·˜",t:"æ— å¦„ã€‚é¡ºå…¶è‡ªç„¶ï¼Œä¸è¦æœ‰ä¸åˆ‡å®é™…çš„æœŸæœ›ã€‚",type:"è§„åˆ’"},{n:26,p:"dÃ  chÃ¹",h:"ä·™",t:"å¤§çš„è“„å…»ã€‚ç§¯ç´¯åŠ›é‡å’Œæ½œèƒ½ã€‚",type:"è§„åˆ’"},{n:27,p:"yÃ­",h:"ä·š",t:"é¢å…»ã€‚æ³¨æ„è¨€è¯­å’Œé¥®é£Ÿï¼Œæ»‹å…»èº«å¿ƒã€‚",type:"è§„åˆ’"},{n:28,p:"dÃ  guÃ²",h:"ä·›",t:"å¤§çš„è¿‡åº¦ã€‚å‹åŠ›å·¨å¤§ï¼Œéœ€è¦éå‡¡çš„è¡ŒåŠ¨ã€‚",type:"æŒ‘æˆ˜"},{n:29,p:"kÇn",h:"ä·œ",t:"åé™©ã€‚èº«å¤„å±é™©ä¹‹ä¸­ï¼Œä½†ä¿æŒçœŸè¯šå¯æ¸¡è¿‡ã€‚",type:"æŒ‘æˆ˜"},{n:30,p:"lÃ­",h:"ä·",t:"é™„ç€ã€‚å¦‚ç«ä¸€èˆ¬ï¼Œä¾èµ–äºä»–äººè€Œå‘å…‰ã€‚",type:"è¡ŒåŠ¨"},{n:31,p:"xiÃ¡n",h:"ä·",t:"æ„Ÿåº”ã€‚ç›¸äº’å¸å¼•å’Œå½±å“ã€‚",type:"å¹³é¡º"},{n:32,p:"hÃ©ng",h:"ä·Ÿ",t:"æ’ä¹…ã€‚æŒä¹…å’Œè€åŠ›å¸¦æ¥æˆåŠŸã€‚",type:"è§„åˆ’"},{n:33,p:"dÃ¹n",h:"ä· ",t:"é€€é¿ã€‚æˆ˜ç•¥æ€§æ’¤é€€ï¼Œä¿å­˜å®åŠ›ã€‚",type:"æŒ‘æˆ˜"},{n:34,p:"dÃ  zhuÃ ng",h:"ä·¡",t:"å¤§çš„å¼ºç››ã€‚åŠ›é‡å¼ºå¤§ï¼Œä½†éœ€é˜²æ­¢æ»¥ç”¨ã€‚",type:"è¡ŒåŠ¨"},{n:35,p:"jÃ¬n",h:"ä·¢",t:"å‰è¿›ã€‚è¿›å±•é¡ºåˆ©ï¼Œå¦‚æ—¥ä¸­å¤©ã€‚",type:"è¡ŒåŠ¨"},{n:36,p:"mÃ­ng yÃ­",h:"ä·£",t:"å…‰æ˜å—ä¼¤ã€‚åœ¨é€†å¢ƒä¸­éšè—è‡ªå·±çš„å…‰èŠ’ã€‚",type:"æŒ‘æˆ˜"},{n:37,p:"jiÄ rÃ©n",h:"ä·¤",t:"å®¶äººã€‚å®¶åº­ä¸­çš„è´£ä»»å’Œè§’è‰²ã€‚",type:"å¹³é¡º"},{n:38,p:"kuÃ­",h:"ä·¥",t:"ç½è¿ã€‚æœ‰å¯¹ç«‹å’Œè¯¯è§£ï¼Œæ±‚åŒå­˜å¼‚ã€‚",type:"æŒ‘æˆ˜"},{n:39,p:"jiÇn",h:"ä·¦",t:"è‰°éš¾ã€‚å‰è¿›æœ‰å›°éš¾ï¼Œå¯»æ±‚å¸®åŠ©ã€‚",type:"æŒ‘æˆ˜"},{n:40,p:"xiÃ¨",h:"ä·§",t:"è§£è„±ã€‚å›°éš¾å¾—åˆ°è§£å†³ï¼Œç´§å¼ ç¼“è§£ã€‚",type:"å¹³é¡º"},{n:41,p:"sÇ”n",h:"ä·¨",t:"å‡å°‘ã€‚æœ‰æ—¶æŸå¤±æ˜¯ä¸ºäº†æ›´å¤§çš„æ”¶ç›Šã€‚",type:"è§„åˆ’"},{n:42,p:"yÃ¬",h:"ä·©",t:"å¢ç›Šã€‚åˆ©äºé‡‡å–è¡ŒåŠ¨ï¼Œä¼šå¾—åˆ°å¸®åŠ©ã€‚",type:"è¡ŒåŠ¨"},{n:43,p:"guÃ i",h:"ä·ª",t:"å†³æ–­ã€‚éœ€è¦åšå‡ºåšå®šçš„å†³å®šã€‚",type:"è¡ŒåŠ¨"},{n:44,p:"gÃ²u",h:"ä·«",t:"ç›¸é‡ã€‚æ„å¤–çš„ç›¸é‡ï¼Œé˜´é•¿é˜³æ¶ˆçš„å¼€å§‹ã€‚",type:"æŒ‘æˆ˜"},{n:45,p:"cuÃ¬",h:"ä·¬",t:"èšé›†ã€‚äººæˆ–ç‰©èšé›†åœ¨ä¸€èµ·ã€‚",type:"å¹³é¡º"},{n:46,p:"shÄ“ng",h:"ä·­",t:"ä¸Šå‡ã€‚æŒç»­åŠªåŠ›å¸¦æ¥ç¨³æ­¥çš„æˆé•¿ã€‚",type:"å¹³é¡º"},{n:47,p:"kÃ¹n",h:"ä·®",t:"å›°å¢ƒã€‚è¢«å›°ä½ï¼Œä½†ä¿æŒä¹è§‚å¯æ‰¾åˆ°å‡ºè·¯ã€‚",type:"æŒ‘æˆ˜"},{n:48,p:"jÇng",h:"ä·¯",t:"äº•ã€‚å†…åœ¨èµ„æºä¸å˜ï¼Œå¯ä»¥æ»‹å…»ä»–äººã€‚",type:"è§„åˆ’"},{n:49,p:"gÃ©",h:"ä·°",t:"å˜é©ã€‚å½»åº•çš„æ”¹å˜å’Œé©å‘½ã€‚",type:"è¡ŒåŠ¨"},{n:50,p:"dÇng",h:"ä·±",t:"é¼ã€‚æ‰¿è½½å’Œè½¬åŒ–ï¼Œè±¡å¾æ–°çš„å¼€å§‹ã€‚",type:"å¹³é¡º"},{n:51,p:"zhÃ¨n",h:"ä·²",t:"éœ‡åŠ¨ã€‚çªå¦‚å…¶æ¥çš„äº‹ä»¶ï¼Œè™½æƒŠä½†èƒ½å¸¦æ¥æ–°ç”Ÿã€‚",type:"æŒ‘æˆ˜"},{n:52,p:"gÃ¨n",h:"ä·³",t:"åœæ­¢ã€‚ä¿æŒé™æ­¢å’Œå†…å¿ƒçš„å¹³é™ã€‚",type:"è§„åˆ’"},{n:53,p:"jiÃ n",h:"ä·´",t:"æ¸è¿›ã€‚é€æ­¥å‘å±•ï¼Œå¦‚å¥³å‡ºå«ã€‚",type:"è§„åˆ’"},{n:54,p:"guÄ« mÃ¨i",h:"ä·µ",t:"å½’å¦¹ã€‚å…³ç³»å¤„ç†ä¸å½“ï¼Œéœ€è°¨æ…ã€‚",type:"æŒ‘æˆ˜"},{n:55,p:"fÄ“ng",h:"ä·¶",t:"ä¸°ç››ã€‚è¾¾åˆ°é¡¶å³°ï¼Œä½†éœ€é˜²å¤‡è¡°é€€ã€‚",type:"å¹³é¡º"},{n:56,p:"lÇš",h:"ä··",t:"æ—…è¡Œã€‚ä½œä¸ºå¼‚ä¹¡äººçš„å­¤ç‹¬å’Œè°¨æ…ã€‚",type:"å¹³é¡º"},{n:57,p:"xÃ¹n",h:"ä·¸",t:"é¡ºä»ã€‚å¦‚é£ä¸€èˆ¬ï¼Œæ¸©å’Œåœ°æ¸—é€ã€‚",type:"è§„åˆ’"},{n:58,p:"duÃ¬",h:"ä·¹",t:"å–œæ‚¦ã€‚ä¸æœ‹å‹äº¤æµçš„å¿«ä¹ã€‚",type:"å¹³é¡º"},{n:59,p:"huÃ n",h:"ä·º",t:"æ¶£æ•£ã€‚ç¦»æ•£ä¹‹åéœ€è¦é‡æ–°èšåˆã€‚",type:"æŒ‘æˆ˜"},{n:60,p:"jiÃ©",h:"ä·»",t:"èŠ‚åˆ¶ã€‚é™åˆ¶æ˜¯å¿…è¦çš„ï¼Œä¸è¦è¿‡åº¦ã€‚",type:"è§„åˆ’"},{n:61,p:"zhÅng fÃº",h:"ä·¼",t:"ä¸­å­šã€‚å†…åœ¨çš„çœŸè¯šå¸¦æ¥æœ€å¤§çš„å½±å“åŠ›ã€‚",type:"å¹³é¡º"},{n:62,p:"xiÇo guÃ²",h:"ä·½",t:"å°çš„è¿‡åº¦ã€‚åœ¨å°äº‹ä¸Šè°¨æ…ï¼Œå¤§äº‹ä¸Šä¸å®œã€‚",type:"æŒ‘æˆ˜"},{n:63,p:"jÃ¬ jÃ¬",h:"ä·¾",t:"æ—¢æµã€‚äº‹æƒ…å·²å®Œæˆï¼Œä½†éœ€è­¦æƒ•ã€‚",type:"å¹³é¡º"},{n:64,p:"wÃ¨i jÃ¬",h:"ä·¿",t:"æœªæµã€‚äº‹æƒ…æœªå®Œæˆï¼Œæ··ä¹±ä¸­å……æ»¡æ½œåŠ›ã€‚",type:"æŒ‘æˆ˜"}],
    SHI_CHEN_DATA: [ {h:23, n:"å­", e:"æ°´"}, {h:1, n:"ä¸‘", e:"åœŸ"}, {h:3, n:"å¯…", e:"æœ¨"}, {h:5, n:"å¯", e:"æœ¨"}, {h:7, n:"è¾°", e:"åœŸ"}, {h:9, n:"å·³", e:"ç«"}, {h:11, n:"åˆ", e:"ç«"}, {h:13, n:"æœª", e:"åœŸ"}, {h:15, n:"ç”³", e:"é‡‘"}, {h:17, n:"é…‰", e:"é‡‘"}, {h:19, n:"æˆŒ", e:"åœŸ"}, {h:21, n:"äº¥", e:"æ°´"} ],
    MONTHLY_HEXAGRAMS: [19, 11, 34, 43, 1, 44, 33, 12, 20, 23, 2, 24],
};

// --- 2. DIET MODULE: Contains all dietary logic and data ---
LifePlannerApp.diet = (() => {
    const HOLIDAY_DATES = {
        cny: { 2023: '01-22', 2024: '02-10', 2025: '01-29', 2026: '02-17', 2027: '02-06', 2028: '01-26' },
        dragonBoat: { 2023: '06-22', 2024: '06-10', 2025: '05-31', 2026: '06-19', 2027: '06-09', 2028: '05-28' },
        midAutumn: { 2023: '09-29', 2024: '09-17', 2025: '10-06', 2026: '09-25', 2027: '09-15', 2028: '10-03' }
    };

    const DIET_LOGIC = {
        dailyMeals: {
            training: { theme: "ğŸ’ª åŠ›é‡æ—¥-ä¸­é«˜ç¢³æ°´", details: "æ—©é¤: ç‡•éº¦ç²¥, æ°´ç…®è›‹\nåˆé¤(è®­ç»ƒå): é¸¡èƒ¸è‚‰/è™¾ä», è—œéº¦/ç³™ç±³, å¤§é‡è”¬èœ\nåŠ é¤: å¸Œè…Šé…¸å¥¶, åšæœ\næ™šé¤: æ¸…è’¸é±¼, ç‚’ç»¿å¶èœ, å°‘é‡å±±è¯/èŠ‹å¤´" },
            rest: { theme: "ğŸ¥— ä¼‘æ¯æ—¥-ä½ç¢³æ°´", details: "æ—©é¤: å°ç±³ç²¥, è±†æµ†, é¸¡è›‹\nåˆé¤: å¤ç‰›è‚‰, å¤§ä»½è”¬èœæ²™æ‹‰\nåŠ é¤: ä¸€ä¸ªè‹¹æœ\næ™šé¤: é±¼å¤´è±†è…æ±¤, æˆ–ç™½èœç‚–è±†è…, æ­é…æ¸…ç‚’æ—¶è”¬" },
            social: { theme: "ğŸ¥‚ ç¤¾äº¤æ—¥-ç­–ç•¥é¥®é£Ÿ", details: "ç­–ç•¥: é¤å‰å–æ°´, å¤šé€‰è’¸ç…®èœè‚´, ç»†åš¼æ…¢å’½, ä¸ƒåˆ†é¥±å³å¯ã€‚äº«å—ç¾é£Ÿ, æ— éœ€æ„§ç–šã€‚" }
        },
        seasonalFocus: {
            spring: { theme: "æ˜¥å­£: ç–è‚ç†æ°”ï¼Œå‡å‘é˜³æ°”", points: "å£å‘³å®œæ¸…æ·¡ï¼Œå¤šåƒç”˜å‘³ã€è¾›å‘³çš„é£Ÿç‰©ã€‚", protagonists: "éŸ­èœã€è èœã€é¦™æ¤¿ã€æ˜¥ç¬‹ã€è±†è‹—ã€è‰è“ã€æ–°é²œæ²³é²œã€‚", dishes: "é¦™æ¤¿ç‚’é¸¡è›‹ã€æ²¹ç„–æ˜¥ç¬‹ã€éŸ­èœç‚’æ²³è™¾ã€è‰è“é…¸å¥¶ã€‚" },
            summer: { theme: "å¤å­£: æ¸…çƒ­è§£æš‘ï¼Œå¥è„¾å…»å¿ƒ", points: "æ¸…æ·¡ç¥›æ¹¿ï¼Œå¤šåƒâ€œç“œæ—â€å’Œæœ‰æ¸…å‡‰ä½œç”¨çš„è”¬èœã€‚", protagonists: "è‹¦ç“œã€å†¬ç“œã€ä¸ç“œã€é»„ç“œã€ç©ºå¿ƒèœã€è¥¿ç“œã€æ¡ƒå­ã€‚", dishes: "å‡‰æ‹Œè‹¦ç“œã€å†¬ç“œæµ·å¸¦æ±¤ã€è’œè“‰ç©ºå¿ƒèœã€ç»¿è±†æ±¤ã€‚" },
            autumn: { theme: "ç§‹å­£: æ¶¦ç‡¥æ»‹é˜´ï¼Œå…»è‚ºä¸ºå…ˆ", points: "æ»‹é˜´æ¶¦ç‡¥ï¼Œå¤šåƒç™½è‰²é£Ÿç‰©ã€‚é€‚é‡æ‘„å…¥é…¸å‘³é£Ÿç‰©ä»¥æ”¶æ•›è‚ºæ°”ã€‚", protagonists: "è²è—•ã€å±±è¯ã€ç™¾åˆã€å—ç“œã€æ¢¨ã€èƒèŸ¹ã€é¸­è‚‰ã€‚", dishes: "è²è—•æ’éª¨æ±¤ã€å±±è¯ç‚’æœ¨è€³ã€é“¶è€³é›ªæ¢¨ç¾¹ã€æ¸…è’¸å¤§é—¸èŸ¹ã€‚" },
            winter: { theme: "å†¬å­£: æ¸©è¡¥è‚¾é˜³ï¼Œæ½œè—ç²¾æ°”", points: "æ¸©çƒ­è¡¥å…»ï¼Œå¢åŠ è›‹ç™½è´¨æ‘„å…¥ä»¥å¾¡å¯’ã€‚å¤šåƒæ ¹èŒç±»è”¬èœã€‚", protagonists: "ç™½èåœã€å¤§ç™½èœã€ç¾Šè‚‰ã€ç‰›è‚‰ã€èŒè‡ã€æŸ‘æ©˜ã€‚", dishes: "èåœç‚–ç¾Šè‚‰/ç‰›è…©ã€ç™½èœè±†è…ä¿å¹³å®‰ã€é¦™è‡ç‚–é¸¡æ±¤ã€‚" }
        },
        holidays: {
            cnyEve: { theme: "ğŸ§§ é™¤å¤•: å¥åº·å¹´å¤œé¥­", details: "æ ¸å¿ƒ: å¤šè’¸ç…®å‡‰æ‹Œ, å°‘æ²¹ç‚¸çº¢çƒ§, è¤ç´ æ­é…ã€‚\næ¨èèœ: æ¸…è’¸é±¼(å¹´å¹´æœ‰ä½™), ç™½ç¼è™¾(ç”Ÿæœºå‹ƒå‹ƒ), å…¨å®¶ç¦ç ‚é”…(æ¸©æš–å›¢åœ†)ã€‚" },
            dragonBoat: { theme: "ğŸ² ç«¯åˆ: å“å°å¥åº·ç²½", details: "æ ¸å¿ƒ: æµ…å°è¾„æ­¢ï¼Œä¼˜é€‰å¥åº·é¦…æ–™ã€‚\næ¨è: ä¼˜é€‰æ‚ç²®ç²½ã€çº¢è±†ç²½ã€ç´ ç²½ï¼›è‚‰ç²½çƒ­é‡é«˜ï¼Œä¸å®¶äººåˆ†äº«ä¸€ä¸ªå³å¯ã€‚" },
            midAutumn: { theme: "ğŸŒ• ä¸­ç§‹: æœˆé¥¼é…æ¸…èŒ¶", details: "æ ¸å¿ƒ: åˆ†äº«ä¸å“å‘³ï¼Œè€Œéé¥±è…¹ã€‚\nå»ºè®®: å°†æœˆé¥¼åˆ‡æˆå°å—ä¸å®¶äººåˆ†äº«ï¼Œæ­é…ä¹Œé¾™èŒ¶æˆ–æ™®æ´±èŒ¶è§£è…»ã€‚" },
            winterSolstice: { theme: "ğŸ¥Ÿ å†¬è‡³: å¥åº·é¥ºå­å®´", details: "ä¿—è¯è¯´â€œå†¬è‡³å¤§å¦‚å¹´â€ã€‚\nå»ºè®®: å…¨å®¶ä¸€èµ·åŒ…ä¸‰é²œé¦…ã€ç´ é¦…é¥ºå­ï¼Œè‚‰é¦…é€‰æ‹©ç²¾ç˜¦è‚‰å¹¶å¤šåŠ è”¬èœï¼Œå¢åŠ è†³é£Ÿçº¤ç»´ã€‚" },
            newYear: { theme: "ğŸ‰ å…ƒæ—¦: å®¶åº­èšé¤", details: "åº†ç¥æ–°å¹´ï¼Œå¯å®‰æ’ä¸€æ¬¡ç­–ç•¥æ€§è‡ªç”±é¤ã€‚\nè¦ç‚¹: äº«å—ç¾é£Ÿï¼Œä½†æ³¨æ„æ€»é‡ï¼Œä¿æŒå…«åˆ†é¥±ã€‚" },
            laborDay: { theme: "ğŸ› ï¸ åŠ³åŠ¨èŠ‚: èƒ½é‡è¡¥å……", details: "å¦‚æœå¤–å‡ºæ´»åŠ¨ï¼Œè®°å¾—è¡¥å……ä¼˜è´¨ç¢³æ°´å’Œè›‹ç™½è´¨ã€‚" },
            nationalDay: { theme: "ğŸ‡¨ğŸ‡³ å›½åº†èŠ‚: å‡ºè¡Œæ³¨æ„é¥®é£Ÿ", details: "é•¿å‡å‡ºè¡Œï¼ŒèˆŸè½¦åŠ³é¡¿ï¼Œé¥®é£Ÿæ›´åº”è§„å¾‹ã€‚\nå»ºè®®: é¿å…æš´é¥®æš´é£Ÿï¼Œå¤šå–æ°´ï¼Œå¤šåƒæ°´æœè”¬èœï¼Œä¿æŒè‚ èƒƒæ´»åŠ›ã€‚" }
        },
        solarTerms: {"02-04":"ç«‹æ˜¥","02-19":"é›¨æ°´","03-05":"æƒŠè›°","03-20":"æ˜¥åˆ†","04-04":"æ¸…æ˜","04-19":"è°·é›¨","05-05":"ç«‹å¤","05-21":"å°æ»¡","06-05":"èŠ’ç§","06-21":"å¤è‡³","07-06":"å°æš‘","07-22":"å¤§æš‘","08-07":"ç«‹ç§‹","08-23":"å¤„æš‘","09-07":"ç™½éœ²","09-23":"ç§‹åˆ†","10-08":"å¯’éœ²","10-23":"éœœé™","11-07":"ç«‹å†¬","11-22":"å†¬è‡³","12-07":"å¤§é›ª","12-21":"å†¬è‡³","01-05":"å°å¯’","01-20":"å¤§å¯’"}
    };

    const formatMonthDayKey = (date) => `${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    
    const getPlan = (date) => {
        const year = date.getFullYear();
        const monthDay = formatMonthDayKey(date);
        
        // Priority 1: Holidays (Precise)
        const tomorrow = new Date(date);
        tomorrow.setDate(date.getDate() + 1);
        if (HOLIDAY_DATES.cny[tomorrow.getFullYear()] === formatMonthDayKey(tomorrow)) return DIET_LOGIC.holidays.cnyEve;
        if (HOLIDAY_DATES.dragonBoat[year] === monthDay) return DIET_LOGIC.holidays.dragonBoat;
        if (HOLIDAY_DATES.midAutumn[year] === monthDay) return DIET_LOGIC.holidays.midAutumn;
        if (monthDay === '01-01') return DIET_LOGIC.holidays.newYear;
        if (monthDay === '05-01') return DIET_LOGIC.holidays.laborDay;
        if (monthDay === '10-01') return DIET_LOGIC.holidays.nationalDay;
        if ((monthDay === '12-21' || monthDay === '12-22') && DIET_LOGIC.solarTerms[monthDay] === 'å†¬è‡³') return DIET_LOGIC.holidays.winterSolstice;

        // Priority 2: Solar Terms
        const solarTerm = DIET_LOGIC.solarTerms[monthDay];
        if (solarTerm) {
            const month = date.getMonth();
            const seasonKey = (month >= 2 && month <= 4) ? 'spring' : (month >= 5 && month <= 7) ? 'summer' : (month >= 8 && month <= 10) ? 'autumn' : 'winter';
            const seasonalData = DIET_LOGIC.seasonalFocus[seasonKey];
            return {
                theme: `èŠ‚æ°”: ${solarTerm}`,
                details: `ä»Šæ—¥è¿›å…¥â€œ${solarTerm}â€èŠ‚æ°”ï¼Œé¥®é£Ÿå®œéµå¾ª[${seasonalData.theme}]åŸåˆ™ã€‚\n\né¥®é£Ÿè¦ç‚¹: ${seasonalData.points}\nä¸»è§’é£Ÿæ: ${seasonalData.protagonists}\næ¨èèœå¼: ${seasonalData.dishes}`
            };
        }

        // Priority 3: Regular Weekly Cycle
        const dayOfWeek = date.getDay(); // 0=Sun, 1=Mon...
        let planType = (dayOfWeek === 1 || dayOfWeek === 3 || dayOfWeek === 5) ? 'training' : (dayOfWeek === 6) ? 'social' : 'rest';
        
        const weeklyPlan = DIET_LOGIC.dailyMeals[planType];
        const month = date.getMonth();
        const seasonKey = (month >= 2 && month <= 4) ? 'spring' : (month >= 5 && month <= 7) ? 'summer' : (month >= 8 && month <= 10) ? 'autumn' : 'winter';
        const seasonalData = DIET_LOGIC.seasonalFocus[seasonKey];
        
        const combinedDetails = `${weeklyPlan.details}\n\n---\nã€å½“å­£é¥®é£Ÿæ™ºæ…§: ${seasonalData.theme}ã€‘\n- é¥®é£Ÿè¦ç‚¹: ${seasonalData.points}\n- ä¸»è§’é£Ÿæ: ${seasonalData.protagonists}\n- æ¨èèœå¼: ${seasonalData.dishes}`;

        return { theme: weeklyPlan.theme, details: combinedDetails };
    };

    return { getDailyPlan: getPlan };
})();

// --- 3. STATE MODULE: Manages the application's current state ---
LifePlannerApp.state = {
    currentDate: new Date(),
    hero: {},
    tasks: [],
    pastFriends: [], 
    birthdayMap: new Map()
};

// --- 4. STORAGE MODULE: Handles all interactions with localStorage ---
LifePlannerApp.storage = (() => {
    const { STORAGE_KEYS } = LifePlannerApp.config;
    const safeJSONParse = (jsonString, defaultValue) => {
        try { return JSON.parse(jsonString) || defaultValue; } catch { return defaultValue; }
    };
    return {
        get: (key, defaultValue) => safeJSONParse(localStorage.getItem(key), defaultValue),
        set: (key, value) => localStorage.setItem(key, JSON.stringify(value)),
        loadAllData: () => {
            const { state } = LifePlannerApp;
            state.hero = LifePlannerApp.storage.get(STORAGE_KEYS.HERO, { name: '', birthday: '' });
            state.tasks = LifePlannerApp.storage.get(STORAGE_KEYS.TASKS, []);
            state.pastFriends = LifePlannerApp.storage.get(STORAGE_KEYS.PAST_FRIENDS, [
                { name: 'ç‹æ¶›', role: 'å‰åŒäº‹', job: 'ç¨‹åºå‘˜', industry: 'è½¯ä»¶', city: 'åŒ—äº¬', hobby: 'æ¸¸æˆ', bday: '04-01', reason: 'ç¦»èŒåè”ç³»æ¸å°‘', influence: 'weak', resources: 'æŠ€æœ¯èƒ½åŠ›å¼º', benefactor: 'å¾…è¡¥å……' },
                { name: 'æ—ç³', role: 'å¤§å­¦åŒå­¦', job: 'å…¬åŠ¡å‘˜', industry: 'æ”¿åºœ', city: 'è€å®¶', hobby: 'çœ‹ä¹¦', bday: '09-10', reason: 'æ¯•ä¸šåå¼‚åœ°å‘å±•', influence: 'weak', resources: 'å¾…è¡¥å……', benefactor: 'å¾…è¡¥å……' }
            ]);
        }
    };
})();

// --- 5. UI MODULE: Handles all DOM interactions and rendering ---
LifePlannerApp.ui = (() => {
    const { state, config, diet, storage } = LifePlannerApp;
    const { I_CHING_DATA, MONTHLY_HEXAGRAMS, SHI_CHEN_DATA, STORAGE_KEYS } = config;

    const DOMElements = {
        calendarBody: document.getElementById('calendar-body'), monthYearHeader: document.getElementById('month-year-header'),
        heroNameInput: document.getElementById('hero-name'), heroBirthdayInput: document.getElementById('hero-birthday'),
        saveHeroBtn: document.getElementById('btn-save-hero'), heroAgeDisplay: document.getElementById('hero-age-display'),
        dateJumperTextInput: document.getElementById('date-jumper-text'), dateJumperPickerInput: document.getElementById('date-jumper-picker'),
        jumpToDateBtn: document.getElementById('btn-jump-to-date'), wealthAssetsInput: document.getElementById('wealth-assets'),
        wealthLiabilitiesInput: document.getElementById('wealth-liabilities'), wealthCashflowInput: document.getElementById('wealth-cashflow'),
        netWorthSpan: document.getElementById('net-worth'), annoyanceFundSpan: document.getElementById('annoyance-fund'),
        addTaskForm: document.getElementById('add-task-form'), newTaskInput: document.getElementById('new-task-input'),
        taskBacklogContainer: document.getElementById('task-backlog-container'), btnScheduleTasks: document.getElementById('btn-schedule-tasks'),
        accordions: document.querySelectorAll('.accordion-toggle'),
        tooltipContainer: document.getElementById('custom-tooltip-container'),
        prevYearBtn: document.getElementById('prev-year'), prevMonthBtn: document.getElementById('prev-month'),
        todayBtn: document.getElementById('go-to-today'), nextMonthBtn: document.getElementById('next-month'),
        nextYearBtn: document.getElementById('next-year'),
        searchInput: document.getElementById('searchInput'),
        goldenTableBody: document.querySelector('#golden-circle-table tbody'),
        pastTableBody: document.querySelector('#past-friends-table tbody'),
        addPastFriendBtn: document.getElementById('add-past-friend-btn')
    };
    
    const getAge = (birthDate, onDate) => { let age = onDate.getFullYear() - birthDate.getFullYear(); const m = onDate.getMonth() - birthDate.getMonth(); if (m < 0 || (m === 0 && onDate.getDate() < birthDate.getDate())) age--; return age; };
    const formatDateKey = (date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    const formatMonthKey = (date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
    const mulberry32 = (seed) => () => { let t = seed += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; };
    const getHexagramForDate = (date) => { const seed = date.getFullYear() * 10000 + (date.getMonth() + 1) * 100 + date.getDate(); const rand = mulberry32(seed); const index = Math.floor(rand() * 64); return I_CHING_DATA[index]; };

    const showToast = (message, duration = 3000) => {
        const toast = document.createElement('div');
        toast.className = 'toast-notification';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => { toast.classList.add('show'); }, 10);
        setTimeout(() => {
            toast.classList.remove('show');
            toast.addEventListener('transitionend', () => toast.remove());
        }, duration);
    };

    const tooltip = {
        element: null,
        init: function() {
            this.element = document.createElement('div');
            this.element.className = 'custom-tooltip';
            DOMElements.tooltipContainer.appendChild(this.element);
        },
        show: function(content, event) {
            this.element.innerHTML = content.replace(/\n/g, '<br>');
            this.element.classList.add('show');
            this.updatePosition(event);
        },
        hide: function() { this.element.classList.remove('show'); },
        updatePosition: function(event) {
            let x = event.pageX + 15; let y = event.pageY + 15;
            if (x + this.element.offsetWidth > window.innerWidth) x = event.pageX - this.element.offsetWidth - 15;
            if (y + this.element.offsetHeight > window.innerHeight) y = event.pageY - this.element.offsetHeight - 15;
            this.element.style.left = `${x}px`; this.element.style.top = `${y}px`;
        }
    };
    
    const renderAll = () => { renderCalendar(); renderTaskList(); loadFinancials(); updateHeroAgeDisplay(); };

    function renderCalendar() {
        DOMElements.calendarBody.innerHTML = '';
        DOMElements.monthYearHeader.textContent = `${state.currentDate.getFullYear()}å¹´ ${state.currentDate.getMonth() + 1}æœˆ`;
        const { year, month } = { year: state.currentDate.getFullYear(), month: state.currentDate.getMonth() };
        const firstDayOfMonth = new Date(year, month, 1);
        let startingDay = (firstDayOfMonth.getDay() + 6) % 7;
        let dateCounter = new Date(firstDayOfMonth);
        dateCounter.setDate(dateCounter.getDate() - startingDay);
        const todayKey = formatDateKey(new Date());
        let heroBirthDate = state.hero.birthday ? new Date(state.hero.birthday) : null;

        for (let i = 0; i < 6; i++) {
            const row = document.createElement('tr');
            for (let j = 0; j < 7; j++) {
                const cell = document.createElement('td');
                const cellDate = new Date(dateCounter);
                const dateKey = formatDateKey(cellDate);
                const hexagram = getHexagramForDate(cellDate);

                cell.innerHTML = `
                    <div class="cell-wrapper">
                        <div class="cell-top">
                            <div class="daily-wisdom" title="${hexagram.t}"><div class="gua-symbol">${hexagram.h}</div><div>${hexagram.p}</div></div>
                            <div class="date-header"><span class="birthday-tag"></span><span class="date-number">${cellDate.getDate()}</span></div>
                        </div>
                        <div class="reminders"></div>
                        <div class="notes" contenteditable="true" data-datekey="${dateKey}">${storage.get(STORAGE_KEYS.NOTES, {})[dateKey] || ''}</div>
                    </div>`;
                
                const remindersContainer = cell.querySelector('.reminders');
                let remindersHTML = [];
                
                const dietPlan = diet.getDailyPlan(cellDate);
                if (dietPlan) remindersHTML.push(`<div class="reminder reminder-diet" data-tooltip-content="${dietPlan.details.replace(/"/g, '&quot;')}"><span class="reminder-text">${dietPlan.theme}</span></div>`);
                
                const cellMonthDay = `${String(cellDate.getMonth() + 1).padStart(2, '0')}-${String(cellDate.getDate()).padStart(2, '0')}`;
                if (state.birthdayMap.has(cellMonthDay)) {
                    state.birthdayMap.get(cellMonthDay).forEach(friend => remindersHTML.push(`<div class="reminder reminder-friend" title="ä»Šå¤©æ˜¯ ${friend.name} çš„ç”Ÿæ—¥ï¼"><span class="reminder-text">ğŸ‚ ${friend.name} ç”Ÿæ—¥</span></div>`));
                }

                state.tasks.filter(t => t.scheduledFor && t.scheduledFor.startsWith(dateKey)).forEach(task => {
                    const timeMatch = task.scheduledFor.match(/(\d{2}:\d{2})$/);
                    const prefix = timeMatch ? `[${timeMatch[1]}]` : 'âœ…';
                    remindersHTML.push(`<div class="reminder reminder-task" title="${task.text}"><span class="reminder-text">${prefix} ${task.text}</span><span class="delete-reminder-btn" data-id="${task.id}">ğŸ—‘ï¸</span></div>`);
                });
                
                if (remindersHTML.length > 0) remindersContainer.innerHTML = remindersHTML.join('');
                if (cellDate.getMonth() !== month) cell.classList.add('other-month');
                if (dateKey === todayKey) cell.classList.add('today');
                if (heroBirthDate && cellDate.getDate() === heroBirthDate.getDate() && cellDate.getMonth() === heroBirthDate.getMonth()) { 
                    cell.classList.add('birthday'); 
                    cell.querySelector('.birthday-tag').textContent = `ç”Ÿæ—¥ (${getAge(heroBirthDate, cellDate)}å²)`; 
                }

                row.appendChild(cell);
                dateCounter.setDate(dateCounter.getDate() + 1);
            }
            DOMElements.calendarBody.appendChild(row);
        }
    }
    
    function renderTaskList() { 
        DOMElements.taskBacklogContainer.innerHTML = ''; 
        const unscheduledTasks = state.tasks.filter(t => !t.scheduledFor); 
        if (unscheduledTasks.length === 0) { DOMElements.taskBacklogContainer.innerHTML = '<p style="color: #94a3b8;">æš‚æ— å¾…åŠä»»åŠ¡ã€‚</p>'; return; } 
        unscheduledTasks.forEach(task => { 
            const card = document.createElement('div'); 
            card.className = 'task-card'; 
            card.innerHTML = `<span>${task.text}</span><button class="delete-btn delete-task-btn" data-id="${task.id}">ğŸ—‘ï¸</button>`; 
            DOMElements.taskBacklogContainer.appendChild(card); 
        }); 
    }

    const handleNavigation = (action) => {
        switch (action) {
            case 'prev-year': state.currentDate.setFullYear(state.currentDate.getFullYear() - 1); break;
            case 'prev-month': state.currentDate.setMonth(state.currentDate.getMonth() - 1); break;
            case 'today': state.currentDate = new Date(); break;
            case 'next-month': state.currentDate.setMonth(state.currentDate.getMonth() + 1); break;
            case 'next-year': state.currentDate.setFullYear(state.currentDate.getFullYear() + 1); break;
        }
        renderAll();
    };
    
    function saveHeroInfo() { 
        state.hero = { name: DOMElements.heroNameInput.value, birthday: DOMElements.heroBirthdayInput.value }; 
        storage.set(STORAGE_KEYS.HERO, state.hero); 
        showToast('ä¸»äººå…¬ä¿¡æ¯å·²ä¿å­˜!'); 
        renderAll(); 
    }
    
    function updateDerivedFinancials() { 
        const assets = parseFloat(DOMElements.wealthAssetsInput.value) || 0; 
        const liabilities = parseFloat(DOMElements.wealthLiabilitiesInput.value) || 0; 
        const cashflow = parseFloat(DOMElements.wealthCashflowInput.value) || 0;
        
        DOMElements.netWorthSpan.textContent = (assets - liabilities).toLocaleString('zh-CN', {minimumFractionDigits: 0, maximumFractionDigits: 0}); 
        
        const annoyanceFund = cashflow * 0.05;
        DOMElements.annoyanceFundSpan.textContent = annoyanceFund.toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    function loadFinancials() { 
        const financials = storage.get(STORAGE_KEYS.FINANCIALS, {}); 
        const monthData = financials[formatMonthKey(state.currentDate)] || { assets: '', liabilities: '', cashflow: '' }; 
        DOMElements.wealthAssetsInput.value = monthData.assets; 
        DOMElements.wealthLiabilitiesInput.value = monthData.liabilities; 
        DOMElements.wealthCashflowInput.value = monthData.cashflow; 
        updateDerivedFinancials(); 
    }

    function saveFinancials() { 
        const financials = storage.get(STORAGE_KEYS.FINANCIALS, {}); 
        const monthKey = formatMonthKey(state.currentDate); 
        financials[monthKey] = { assets: DOMElements.wealthAssetsInput.value, liabilities: DOMElements.wealthLiabilitiesInput.value, cashflow: DOMElements.wealthCashflowInput.value }; 
        storage.set(STORAGE_KEYS.FINANCIALS, financials); 
        updateDerivedFinancials(); 
    }

    function updateHeroAgeDisplay() { 
        if (state.hero.birthday) { 
            const birthDate = new Date(state.hero.birthday); 
            const age = getAge(birthDate, state.currentDate); 
            DOMElements.heroAgeDisplay.textContent = `å½“å‰å¹´é¾„: ${age} å²`; 
        } else { 
            DOMElements.heroAgeDisplay.textContent = ''; 
        } 
    }
    
    function handleJumpToDate() { 
        let targetDate = null; 
        const textValue = DOMElements.dateJumperTextInput.value.trim(); 
        if (textValue) { 
            const processedText = textValue.replace(/[å¹´æœˆ]/g, '-').replace(/[æ—¥]/g, ''); 
            targetDate = new Date(processedText); 
            if (isNaN(targetDate.getTime())) { showToast('æ—¥æœŸæ ¼å¼æ— æ³•è¯†åˆ«ï¼Œè¯·é‡è¯•ã€‚'); return; } 
            DOMElements.dateJumperTextInput.value = ''; 
        } else if (DOMElements.dateJumperPickerInput.value) { 
            targetDate = new Date(DOMElements.dateJumperPickerInput.value); 
        } 
        if (targetDate && !isNaN(targetDate.getTime())) { 
            state.currentDate = new Date(targetDate.valueOf() + targetDate.getTimezoneOffset() * 60 * 1000); 
            renderAll(); 
        } 
    }
    
    function addTask(e) {
        e.preventDefault();
        const rawText = DOMElements.newTaskInput.value.trim();
        if (!rawText) return;
        const taskStrings = rawText.split(/[,ï¼Œ]/);
        taskStrings.forEach(taskString => {
            let text = taskString.trim();
            if (!text) return;
            let type = 'æ—¥å¸¸';
            if (text.startsWith('!')) { type = 'è¡ŒåŠ¨'; text = text.substring(1).trim(); }
            else if (text.startsWith('?')) { type = 'è§„åˆ’'; text = text.substring(1).trim(); }
            if(text) state.tasks.push({ id: Date.now() + Math.random(), text: text, type: type, scheduledFor: null });
        });
        storage.set(STORAGE_KEYS.TASKS, state.tasks);
        DOMElements.newTaskInput.value = '';
        renderAll();
    }

    function handleSchedule() {
        const unscheduledTasks = state.tasks.filter(t => !t.scheduledFor);
        if (unscheduledTasks.length === 0) { showToast('æ²¡æœ‰å¾…åŠä»»åŠ¡éœ€è¦è§„åˆ’ã€‚'); return; }
        const period = document.getElementById('schedule-period').value;
        const startDate = new Date(state.currentDate);
        let scheduleSlots = [];
        const smartDistribute = (tasksToDistribute, availableSlots, priorityMatrix) => {
            const taskGroups = { 'è¡ŒåŠ¨': tasksToDistribute.filter(t=>t.type==='è¡ŒåŠ¨'), 'è§„åˆ’': tasksToDistribute.filter(t=>t.type==='è§„åˆ’'), 'æ—¥å¸¸': tasksToDistribute.filter(t=>t.type==='æ—¥å¸¸') };
            const tryToPlaceTask = (task, slotTypes) => {
                for (const slot of availableSlots) {
                    if (!slot.isFull && slotTypes.includes(slot.type)) { slot.tasks.push(task); task.scheduledFor = slot.key; if (slot.tasks.length >= slot.capacity) slot.isFull = true; return true; }
                } return false;
            };
            for (const taskType of ['è¡ŒåŠ¨', 'è§„åˆ’', 'æ—¥å¸¸']) {
                taskGroups[taskType].forEach(task => { const priorities = priorityMatrix[taskType]; for (const p of priorities) { if(tryToPlaceTask(task, [p])) break; }});
            }
            const leftovers = tasksToDistribute.filter(t => !t.scheduledFor);
            leftovers.forEach(task => tryToPlaceTask(task, ['å¹³é¡º', 'è§„åˆ’', 'è¡ŒåŠ¨']));
        };
        
         if (period === 'day') {
            const shichenPriority = { 'è¡ŒåŠ¨': ['ç«', 'æœ¨'], 'è§„åˆ’': ['æ°´', 'æœ¨'], 'æ—¥å¸¸': ['åœŸ', 'é‡‘', 'å¹³é¡º'] };
            const shichenCapacity = { 'ç«': 2, 'æœ¨': 2, 'åœŸ': 1, 'é‡‘': 1, 'æ°´': 1 };
            SHI_CHEN_DATA.forEach(sc => {
                const capacity = shichenCapacity[sc.e] || 1;
                for(let i=0; i<capacity; i++) scheduleSlots.push({ key: `${formatDateKey(startDate)} ${String(sc.h).padStart(2,'0')}:00`, type: sc.e, tasks:[], isFull: false, capacity: 1 });
            });
            smartDistribute(unscheduledTasks, scheduleSlots, shichenPriority);
        } else {
            const hexagramPriority = { 'è¡ŒåŠ¨': ['è¡ŒåŠ¨', 'å¹³é¡º'], 'è§„åˆ’': ['è§„åˆ’', 'å¹³é¡º'], 'æ—¥å¸¸': ['å¹³é¡º', 'è§„åˆ’', 'è¡ŒåŠ¨'] };
            const hexagramCapacity = { 'è¡ŒåŠ¨': 3, 'å¹³é¡º': 2, 'è§„åˆ’': 2, 'æŒ‘æˆ˜': 1 };
            let days = 0;
            if (period === 'week') days = 7;
            if (period === 'month') days = 30;
            if (period === 'year') {
                for (let i = 0; i < 12; i++) {
                    const monthDate = new Date(startDate.getFullYear(), startDate.getMonth() + i, 15);
                    const hexagram = I_CHING_DATA.find(h => h.n === MONTHLY_HEXAGRAMS[monthDate.getMonth()]);
                    scheduleSlots.push({ key: formatDateKey(monthDate), type: hexagram.type, tasks:[], isFull: false, capacity: (hexagramCapacity[hexagram.type] || 1) * 2 });
                }
            } else {
                for (let i = 0; i < days; i++) {
                    const day = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate() + i);
                    const hexagram = getHexagramForDate(day);
                    scheduleSlots.push({ key: formatDateKey(day), type: hexagram.type, tasks:[], isFull: false, capacity: hexagramCapacity[hexagram.type] || 1 });
                }
            }
            smartDistribute(unscheduledTasks, scheduleSlots, hexagramPriority);
        }

        storage.set(STORAGE_KEYS.TASKS, state.tasks);
        renderAll();
        const scheduledCount = unscheduledTasks.filter(t => t.scheduledFor).length;
        showToast(`æ™ºèƒ½è§„åˆ’å®Œæ¯•ï¼å·²åˆ†é… ${scheduledCount} ä¸ªä»»åŠ¡ã€‚`);
    }

    function populateTables() {
        const goldenCircleData = {
            level5: [ { name: 'é™ˆé™', role: 'å®¶äºº', job: 'åŒ»ç”Ÿ', industry: 'åŒ»ç–—', city: 'ä¸Šæµ·', hobby: 'é˜…è¯»ã€èŒ¶è‰º', bday: '03-18', influence: 'strong', resources: 'åŒ»ç–—å¥åº·é¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†', benefactor: 'å¾…è¡¥å……' }, { name: 'æå¼º', role: 'æŒšå‹', job: 'å¾‹å¸ˆ', industry: 'æ³•å¾‹', city: 'åŒ—äº¬', hobby: 'å¥èº«ã€è¾©è®º', bday: '11-02', influence: 'strong', resources: 'æ³•å¾‹å’¨è¯¢ã€é€»è¾‘æ€ç»´', benefactor: 'å¾…è¡¥å……' }, { name: 'ç‹ä¼Ÿ', role: 'å­¦é•¿', job: 'ä¼ä¸šå®¶', industry: 'ç§‘æŠ€', city: 'æ·±åœ³', hobby: 'é«˜å°”å¤«ã€æŠ•èµ„', bday: '08-25', influence: 'strong', resources: 'åˆ›ä¸šç»éªŒã€è¡Œä¸šäººè„‰', benefactor: 'å¾…è¡¥å……' }, { name: 'å¼ æ•', role: 'ä¼´ä¾£', job: 'è®¾è®¡å¸ˆ', industry: 'è‰ºæœ¯', city: 'æ­å·', hobby: 'ç»˜ç”»ã€æ—…è¡Œ', bday: '05-10', influence: 'normal', resources: 'æƒ…æ„Ÿæ”¯æŒã€åˆ›æ„çµæ„Ÿ', benefactor: 'å¾…è¡¥å……' }, { name: 'åˆ˜æ´‹', role: 'å‘å°', job: 'æ•™å¸ˆ', industry: 'æ•™è‚²', city: 'æˆéƒ½', hobby: 'è¶³çƒã€ç¾é£Ÿ', bday: '07-21', influence: 'normal', resources: 'æ•™è‚²èµ„æºã€ç»å¯¹ä¿¡ä»»', benefactor: 'å¾…è¡¥å……' } ],
            level4: [ { name: 'èµµä¸½', role: 'åŒäº‹', job: 'äº§å“ç»ç†', industry: 'äº’è”ç½‘', city: 'åŒ—äº¬', hobby: 'æ»‘é›ª', bday: '01-15' }, { name: 'å­™æ‚¦', role: 'æœ‹å‹', job: 'è¿è¥', industry: 'ç”µå•†', city: 'æ­å·', hobby: 'æ‘„å½±', bday: '02-28' }, { name: 'å‘¨é¹', role: 'åŒå­¦', job: 'å·¥ç¨‹å¸ˆ', industry: 'è½¯ä»¶', city: 'ä¸Šæµ·', hobby: 'ç¼–ç¨‹', bday: '04-12' }, { name: 'å´æ°', role: 'æœ‹å‹', job: 'æŠ•èµ„äºº', industry: 'é‡‘è', city: 'é¦™æ¸¯', hobby: 'å¾’æ­¥', bday: '06-30' }, { name: 'éƒ‘ç§€', role: 'é‚»å±…', job: 'è‡ªç”±èŒä¸š', industry: 'å†™ä½œ', city: 'å¹¿å·', hobby: 'é˜…è¯»', bday: '09-05' }, { name: 'å†¯æ¶›', role: 'å®¢æˆ·', job: 'é”€å”®æ€»ç›‘', industry: 'å¿«æ¶ˆå“', city: 'æ·±åœ³', hobby: 'é’“é±¼', bday: '12-01' }, { name: 'é’±å¤', role: 'å¯¼å¸ˆ', job: 'æ•™æˆ', industry: 'å­¦æœ¯', city: 'å—äº¬', hobby: 'å†å²', bday: '10-18' }, { name: 'è’‹æ¬£', role: 'åˆä½œæ–¹', job: 'å¸‚åœºç»ç†', industry: 'å¹¿å‘Š', city: 'ä¸Šæµ·', hobby: 'çœ‹å±•', bday: '03-22' }, { name: 'æ²ˆæµ©', role: 'ç½‘å‹', job: 'æ¸¸æˆç­–åˆ’', industry: 'æ¸¸æˆ', city: 'æˆéƒ½', hobby: 'ç”µç«', bday: '08-08' }, { name: 'éŸ©æ¢…', role: 'æœ‹å‹', job: 'äººåŠ›èµ„æº', industry: 'å…¨è¡Œä¸š', city: 'åŒ—äº¬', hobby: 'ç‘œä¼½', bday: '05-16' }, { name: 'æ›¹èŠ³', role: 'æœ‹å‹', job: 'UIè®¾è®¡å¸ˆ', industry: 'äº’è”ç½‘', city: 'æ­å·', hobby: 'æ‰‹è´¦', bday: '07-19' }, { name: 'è¢å¹³', role: 'çƒå‹', job: 'ç¨‹åºå‘˜', industry: 'è½¯ä»¶', city: 'æ­¦æ±‰', hobby: 'ç¯®çƒ', bday: '11-11' }, { name: 'é‚“ç³', role: 'ä¹¦å‹', job: 'ç¼–è¾‘', industry: 'å‡ºç‰ˆ', city: 'åŒ—äº¬', hobby: 'å†™ä½œ', bday: '01-29' }, { name: 'è®¸å³°', role: 'å‰åŒäº‹', job: 'æ•°æ®åˆ†æå¸ˆ', industry: 'é‡‘è', city: 'ä¸Šæµ·', hobby: 'ç”µå½±', bday: '04-03' }, { name: 'ä¾¯å‹‡', role: 'å¥èº«æ•™ç»ƒ', job: 'æ•™ç»ƒ', industry: 'å¥åº·', city: 'å¹¿å·', hobby: 'æ’¸é“', bday: '06-14' }, { name: 'å‚…æ˜', role: 'æœ‹å‹', job: 'å»ºç­‘å¸ˆ', industry: 'å»ºç­‘', city: 'é‡åº†', hobby: 'æ¨¡å‹', bday: '09-27' }, { name: 'ä¸ç£Š', role: 'ç½‘å‹', job: 'åšä¸»', industry: 'è‡ªåª’ä½“', city: 'é•¿æ²™', hobby: 'è§†é¢‘å‰ªè¾‘', bday: '12-15' }, { name: 'è–›çª', role: 'æœ‹å‹', job: 'ä¼šè®¡å¸ˆ', industry: 'é‡‘è', city: 'å¤©æ´¥', hobby: 'çƒ˜ç„™', bday: '02-09' }, { name: 'å­”äº®', role: 'åŒå­¦', job: 'ç ”ç©¶ç”Ÿ', industry: 'AI', city: 'åˆè‚¥', hobby: 'ç§‘ç ”', bday: '07-07' }, { name: 'ç™½é›ª', role: 'æœ‹å‹', job: 'æ’ç”»å¸ˆ', industry: 'è‰ºæœ¯', city: 'å¦é—¨', hobby: 'ç”»ç”»', bday: '10-01' }, { name: 'å¸¸è¿œ', role: 'æœ‹å‹', job: 'å…¬åŠ¡å‘˜', industry: 'æ”¿åºœ', city: 'è¥¿å®‰', hobby: 'ä¹¦æ³•', bday: '08-16' }, { name: 'è´ºå†›', role: 'åˆä½œä¼™ä¼´', job: 'CEO', industry: 'åˆåˆ›å…¬å¸', city: 'è‹å·', hobby: 'è·‘æ­¥', bday: '05-25' }, { name: 'åº·è¾‰', role: 'æœ‹å‹', job: 'è®°è€…', industry: 'åª’ä½“', city: 'åŒ—äº¬', hobby: 'é‡‡è®¿', bday: '03-05' }, { name: 'é»„è“‰', role: 'æœ‹å‹', job: 'ç¾é£Ÿå®¶', industry: 'é¤é¥®', city: 'æˆéƒ½', hobby: 'æ¢åº—', bday: '09-12' }, { name: 'è§å³°', role: 'æœ‹å‹', job: 'é¡¹ç›®ç»ç†', industry: 'å»ºç­‘', city: 'å¤§è¿', hobby: 'èˆªæµ·', bday: '12-24' }, { name: 'ä»»ç›ˆç›ˆ', role: 'æœ‹å‹', job: 'éŸ³ä¹å®¶', industry: 'éŸ³ä¹', city: 'ä¸Šæµ·', hobby: 'å¤ç­', bday: '02-18' }, { name: 'ä»¤ç‹å†²', role: 'é…’å‹', job: 'é…¿é…’å¸ˆ', industry: 'é…’ä¸š', city: 'è´µå·', hobby: 'å“é…’', bday: '06-06' }, { name: 'éƒ­é–', role: 'æœ‹å‹', job: 'å…½åŒ»', industry: 'å†œä¸š', city: 'å†…è’™å¤', hobby: 'éª‘é©¬', bday: '10-30' }, { name: 'æ®µèª‰', role: 'ç½‘å‹', job: 'ç¨‹åºå‘˜', industry: 'åŒºå—é“¾', city: 'æ­å·', hobby: 'å›´æ£‹', bday: '01-01' }, { name: 'ç‹è¯­å«£', role: 'æœ‹å‹', job: 'å›¾ä¹¦ç®¡ç†å‘˜', industry: 'æ–‡åŒ–', city: 'è‹å·', hobby: 'è¯»ä¹¦', bday: '04-23' }, { name: 'æ¨è¿‡', role: 'æœ‹å‹', job: 'æ‘„å½±å¸ˆ', industry: 'è‡ªç”±èŒä¸š', city: 'äº‘å—', hobby: 'æ—…è¡Œæ‘„å½±', bday: '07-14' }, { name: 'å°é¾™å¥³', role: 'æœ‹å‹', job: 'èˆè¹ˆå®¶', industry: 'è‰ºæœ¯', city: 'åŒ—äº¬', hobby: 'å…»èœ‚', bday: '11-20' }, { name: 'éŸ¦å°å®', role: 'æœ‹å‹', job: 'å•†äºº', industry: 'è´¸æ˜“', city: 'æ‰¬å·', hobby: 'ç¤¾äº¤', bday: '05-15' }, { name: 'åŒå„¿', role: 'æœ‹å‹', job: 'æŠ¤å£«', industry: 'åŒ»ç–—', city: 'åŒ—äº¬', hobby: 'çƒ¹é¥ª', bday: '08-28' }, { name: 'é™ˆå®¶æ´›', role: 'æœ‹å‹', job: 'NGOå·¥ä½œè€…', industry: 'å…¬ç›Š', city: 'ä¸Šæµ·', hobby: 'å¿—æ„¿è€…', bday: '03-12' }, { name: 'éœé’æ¡', role: 'æœ‹å‹', job: 'ç­–ç•¥åˆ†æå¸ˆ', industry: 'å’¨è¯¢', city: 'åŒ—äº¬', hobby: 'é©¬æœ¯', bday: '09-09' }, { name: 'å¼ æ— å¿Œ', role: 'æœ‹å‹', job: 'ä¸­åŒ»å¸ˆ', industry: 'åŒ»ç–—', city: 'æˆéƒ½', hobby: 'å¤ªæ', bday: '06-20' }, { name: 'èµµæ•', role: 'æœ‹å‹', job: 'éƒ¡ä¸»', industry: 'ç®¡ç†', city: 'å¤§éƒ½', hobby: 'å¸ƒå±€', bday: '10-28' }, { name: 'å‘¨èŠ·è‹¥', role: 'æœ‹å‹', job: 'æŒé—¨', industry: 'æ­¦æ—', city: 'å³¨çœ‰', hobby: 'ç»ƒåŠŸ', bday: '07-09' }, { name: 'è™šç«¹', role: 'æœ‹å‹', job: 'é€é¥æ´¾æŒé—¨', industry: 'ç®¡ç†', city: 'å¤©å±±', hobby: 'ä¸‹æ£‹', bday: '04-08' }, { name: 'çŸ³ç ´å¤©', role: 'æœ‹å‹', job: 'ä¾ å®¢', industry: 'æ±Ÿæ¹–', city: 'ä¾ å®¢å²›', hobby: 'å­¦ä¹ ', bday: '12-08' }, { name: 'ä¸ç°', role: 'æœ‹å‹', job: 'å¸®ä¸»å¤«äºº', industry: 'ç®¡ç†', city: 'é•¿ä¹å¸®', hobby: 'ç©ä¹', bday: '02-14' }, { name: 'è¢æ‰¿å¿—', role: 'æœ‹å‹', job: 'é‡‘è›‡ç‹', industry: 'å†’é™©', city: 'åå±±', hobby: 'æ¢é™©', bday: '05-05' }, { name: 'å¤é’é’', role: 'æœ‹å‹', job: 'æ¸©å®¶å¤§å°å§', industry: 'å®¶æ—', city: 'çŸ³æ¢', hobby: 'å¥³çº¢', bday: '08-15' }, { name: 'èƒ¡æ–', role: 'æœ‹å‹', job: 'é›ªå±±é£ç‹', industry: 'ä¾ å®¢', city: 'é›ªå±±', hobby: 'è¡Œä¾ ä»—ä¹‰', bday: '11-08' }, { name: 'è‹—è‹¥å…°', role: 'æœ‹å‹', job: 'å¤§å®¶é—ºç§€', industry: 'æ–‡åŒ–', city: 'å•†å®¶å ¡', hobby: 'è¯—è¯', bday: '03-25' }, { name: 'ç‹„äº‘', role: 'æœ‹å‹', job: 'è¿åŸè¯€ä¼ äºº', industry: 'å¯»å®', city: 'è—è¾¹', hobby: 'æ±‚ç”Ÿ', bday: '09-30' }, { name: 'æ°´ç¬™', role: 'æœ‹å‹', job: 'æ±Ÿæ¹–å¥³ä¾ ', industry: 'éª‘è¡Œ', city: 'é›ªè°·', hobby: 'éª‘é©¬', bday: '01-20' }, { name: 'é˜¿æœ±', role: 'æœ‹å‹', job: 'æ˜“å®¹é«˜æ‰‹', industry: 'æƒ…æŠ¥', city: 'ç‡•å­å', hobby: 'æ˜“å®¹', bday: '07-07' }, { name: 'é˜¿ç´«', role: 'æœ‹å‹', job: 'æ˜Ÿå®¿æ´¾', industry: 'ç”¨æ¯’', city: 'æ˜Ÿå®¿æµ·', hobby: 'ä½œå¼„äºº', bday: '10-13' } ],
            level3: [ 'ç™½æ¯…', 'è”¡æ–Œ', 'æ›¹ç£Š', 'å¸¸é™', 'ç¨‹çš“', 'å´”å¥', 'æˆ´å…µ', 'é‚“è¶…', 'ä¸éœ', 'è‘£æ´', 'æœå¨Ÿ', 'æ®µå¥•å®', 'æ¨Šçº²', 'èŒƒä¼Ÿ', 'æ–¹æ–‡å±±', 'å†¯å·©', 'å‚…è‰ºä¼Ÿ', 'é«˜åœ†åœ†', 'è‘›ä¼˜', 'è€¿ä¹', 'é¾šç³å¨œ', 'ç®¡è™', 'éƒ­å¾·çº²', 'æµ·æ¸…', 'éŸ©çº¢', 'ä½•å†°', 'æ´ªå‰‘æ¶›', 'ä¾¯é¸¿äº®', 'èƒ¡æ­Œ', 'é»„æ¸¤', 'é»„ç£Š', 'è´¾æ¨ŸæŸ¯', 'å§œæ–‡', 'è’‹é›¯ä¸½', 'é‡‘æ˜Ÿ', 'æ™¯ç”œ', 'å­”ç¬™', 'éƒæœ—', 'é›·ä½³éŸ³', 'æå†°å†°', 'æå¥', 'æé›ªå¥', 'æå®‡æ˜¥', 'æ¢é™', 'æ—æ°¸å¥', 'åˆ˜æ¬¢', 'åˆ˜æ¶›', 'åˆ˜çƒ¨', 'å¨„çƒ¨', 'é™†å·', 'é©¬ä¸œ', 'é©¬ä¼Šç', 'æ¢…å©·', 'é‚£è‹±', 'å®æµ©', 'æ½˜ç²¤æ˜', 'æ¿®å­˜æ˜•', 'ç§¦æµ·ç’', 'ä»»ç´ æ±', 'æ²™æº¢', 'æ²ˆè…¾', 'å®‹ä½³', 'å­™çº¢é›·', 'å­™ä¿ª', 'è°­ç›¾', 'æ±¤å”¯', 'é™¶è™¹', 'ç”°å£®å£®', 'æ±ªå³°', 'ç‹å®å¼º', 'ç‹æ™¯æ˜¥', 'ç‹åƒæº', 'ç‹å­¦åœ»', 'ç‹å¿—æ–‡', 'å´äº¬', 'å´ç§€æ³¢', 'å¤é›¨', 'å¾å¸†', 'å¾å³¥', 'è®¸æ™´', 'é—«å¦®', 'æ¨å¤', 'æ¨æ¾œ', 'æ¨å¹‚', 'å§šæ™¨', 'æ˜“çƒŠåƒçº', 'äºå’Œä¼Ÿ', 'ä½™ç”·', 'è¢æ³‰', 'å²³äº‘é¹', 'å¼ å˜‰è¯‘', 'å¼ æ¶µäºˆ', 'å¼ å›½ç«‹', 'å¼ è¯‘', 'å¼ è‰ºè°‹', 'ç« å­æ€¡', 'èµµæœ¬å±±', 'èµµè–‡', 'ç”„å­ä¸¹', 'å‘¨è¿…' ]
        };
        const allFriends = [ ...goldenCircleData.level5, ...goldenCircleData.level4, ...goldenCircleData.level3.map(name => ({ name: name, bday: `${String(Math.floor(Math.random()*12)+1).padStart(2,'0')}-${String(Math.floor(Math.random()*28)+1).padStart(2,'0')}` })) ];
        
        state.birthdayMap.clear();
        allFriends.forEach(friend => { if (friend.bday && friend.bday.includes('-')) { if (!state.birthdayMap.has(friend.bday)) state.birthdayMap.set(friend.bday, []); state.birthdayMap.get(friend.bday).push(friend); }});

        DOMElements.goldenTableBody.innerHTML = '';
        DOMElements.pastTableBody.innerHTML = '';
        const influences = ['strong', 'normal', 'weak'];
        goldenCircleData.level5.forEach(f => { const influenceClass = f.influence; const influenceText = influenceClass === 'strong' ? 'å¼º' : (influenceClass === 'normal' ? 'ä¸­' : 'å¼±'); DOMElements.goldenTableBody.innerHTML += `<tr><td contenteditable="true">${f.name}</td><td contenteditable="true"><span class="role-tag">${f.role}</span></td><td contenteditable="true">${f.job}</td><td contenteditable="true">${f.industry}</td><td contenteditable="true">${f.city}</td><td contenteditable="true">${f.hobby}</td><td contenteditable="true">${f.bday}</td><td><span class="level level-5">å‘½å‹</span></td><td><span class="influence ${influenceClass}">${influenceText}</span></td><td contenteditable="true">${f.resources}</td><td contenteditable="true">${f.benefactor}</td></tr>`; });
        goldenCircleData.level4.forEach(f => { const randomInfluence = influences[Math.floor(Math.random() * influences.length)]; const influenceClass = randomInfluence; const influenceText = randomInfluence === 'strong' ? 'å¼º' : (randomInfluence === 'normal' ? 'ä¸­' : 'å¼±'); DOMElements.goldenTableBody.innerHTML += `<tr><td contenteditable="true">${f.name}</td><td contenteditable="true"><span class="role-tag">${f.role}</span></td><td contenteditable="true">${f.job || 'å¾…è¡¥å……'}</td><td contenteditable="true">${f.industry || 'å¾…è¡¥å……'}</td><td contenteditable="true">${f.city}</td><td contenteditable="true">${f.hobby}</td><td contenteditable="true">${f.bday}</td><td><span class="level level-4">å¯†å‹</span></td><td><span class="influence ${influenceClass}">${influenceText}</span></td><td contenteditable="true">å¾…è¡¥å……</td><td contenteditable="true">å¾…è¡¥å……</td></tr>`; });
        goldenCircleData.level3.forEach(name => { const friendData = state.birthdayMap.get(allFriends.find(f => f.name === name).bday).find(f => f.name === name); DOMElements.goldenTableBody.innerHTML += `<tr><td contenteditable="true">${name}</td><td contenteditable="true"><span class="role-tag">æœ‹å‹</span></td><td contenteditable="true">å¾…è¡¥å……</td><td contenteditable="true">å¾…è¡¥å……</td><td contenteditable="true">å¾…è¡¥å……</td><td contenteditable="true">å¾…è¡¥å……</td><td contenteditable="true">${friendData.bday}</td><td><span class="level level-3">å¥½å‹</span></td><td><span class="influence weak">å¼±</span></td><td contenteditable="true">å¾…è¡¥å……</td><td contenteditable="true">å¾…è¡¥å……</td></tr>`; });
        
        state.pastFriends.forEach((f, index) => { const influenceClass = f.influence || 'weak'; const influenceText = influenceClass === 'strong' ? 'å¼º' : (influenceClass === 'normal' ? 'ä¸­' : 'å¼±'); DOMElements.pastTableBody.innerHTML += `<tr data-index="${index}"><td contenteditable="true" data-field="name">${f.name}</td><td contenteditable="true" data-field="role"><span class="role-tag">${f.role}</span></td><td contenteditable="true" data-field="job">${f.job}</td><td contenteditable="true" data-field="industry">${f.industry}</td><td contenteditable="true" data-field="city">${f.city}</td><td contenteditable="true" data-field="hobby">${f.hobby}</td><td contenteditable="true" data-field="bday">${f.bday}</td><td contenteditable="true" data-field="reason">${f.reason}</td><td><span class="influence ${influenceClass}">${influenceText}</span></td><td contenteditable="true" data-field="resources">${f.resources}</td><td contenteditable="true" data-field="benefactor">${f.benefactor}</td></tr>`; });
    }

    // --- Public Interface for UI Module ---
    return {
        init: () => {
            tooltip.init();
            DOMElements.heroNameInput.value = state.hero.name;
            DOMElements.heroBirthdayInput.value = state.hero.birthday;
            
            DOMElements.prevYearBtn.addEventListener('click', () => handleNavigation('prev-year'));
            DOMElements.prevMonthBtn.addEventListener('click', () => handleNavigation('prev-month'));
            DOMElements.todayBtn.addEventListener('click', () => handleNavigation('today'));
            DOMElements.nextMonthBtn.addEventListener('click', () => handleNavigation('next-month'));
            DOMElements.nextYearBtn.addEventListener('click', () => handleNavigation('next-year'));
            DOMElements.saveHeroBtn.addEventListener('click', saveHeroInfo);
            DOMElements.jumpToDateBtn.addEventListener('click', handleJumpToDate);
            [DOMElements.wealthAssetsInput, DOMElements.wealthLiabilitiesInput, DOMElements.wealthCashflowInput].forEach(input => input.addEventListener('change', saveFinancials));
            DOMElements.accordions.forEach(accordion => { accordion.addEventListener('click', () => { accordion.classList.toggle('active'); const content = accordion.nextElementSibling; content.classList.toggle('active'); }); });
            DOMElements.addTaskForm.addEventListener('submit', addTask);
            DOMElements.btnScheduleTasks.addEventListener('click', handleSchedule);
            DOMElements.addPastFriendBtn.addEventListener('click', () => {
                state.pastFriends.unshift({ name: 'æ–°æœ‹å‹', role: 'å¾…å®šä¹‰', job: '', industry: '', city: '', hobby: '', bday: '', reason: 'æ–°æ·»åŠ ', influence: 'weak', resources: '', benefactor: '' });
                storage.set(STORAGE_KEYS.PAST_FRIENDS, state.pastFriends);
                populateTables();
                showToast('å·²æ·»åŠ æ–°è¡Œè‡³â€œä¼¼æ°´å¹´åâ€ï¼Œè¯·ç›´æ¥ç¼–è¾‘ã€‚');
            });

            // Event Delegation for dynamic content
            DOMElements.calendarBody.addEventListener('input', e => { if (e.target.classList.contains('notes')) { const notes = storage.get(STORAGE_KEYS.NOTES, {}); notes[e.target.dataset.datekey] = e.target.innerHTML; storage.set(STORAGE_KEYS.NOTES, notes); } });
            DOMElements.taskBacklogContainer.addEventListener('click', e => { const target = e.target.closest('.delete-task-btn'); if (target) { const id = parseFloat(target.dataset.id); state.tasks = state.tasks.filter(t => t.id !== id); storage.set(STORAGE_KEYS.TASKS, state.tasks); renderAll(); }});
            DOMElements.calendarBody.addEventListener('click', e => { const target = e.target.closest('.delete-reminder-btn'); if (target) { const taskId = parseFloat(target.dataset.id); state.tasks = state.tasks.filter(t => t.id !== taskId); storage.set(STORAGE_KEYS.TASKS, state.tasks); renderAll(); }});
            DOMElements.searchInput.addEventListener('keyup', e => { const filterText = e.target.value.toLowerCase(); document.querySelectorAll('.contacts-table tbody tr').forEach(row => { row.style.display = row.textContent.toLowerCase().includes(filterText) ? "" : "none"; }); });
            DOMElements.pastTableBody.addEventListener('blur', (e) => {
                const target = e.target.closest('td[contenteditable="true"]');
                if(target) {
                    const rowIndex = target.parentElement.dataset.index;
                    const field = target.dataset.field;
                    if(rowIndex && field && state.pastFriends[rowIndex]) {
                        state.pastFriends[rowIndex][field] = target.innerText.replace(/<span.*?>.*?<\/span>/g, '').trim(); // Sanitize
                        storage.set(STORAGE_KEYS.PAST_FRIENDS, state.pastFriends);
                        showToast('â€œä¼¼æ°´å¹´åâ€è®°å½•å·²è‡ªåŠ¨ä¿å­˜ã€‚');
                    }
                }
            }, true);
            DOMElements.calendarBody.addEventListener('mouseover', e => { const target = e.target.closest('.reminder-diet'); if (target) tooltip.show(target.dataset.tooltipContent, e); });
            DOMElements.calendarBody.addEventListener('mouseout', e => { const target = e.target.closest('.reminder-diet'); if (target) tooltip.hide(); });
            DOMElements.calendarBody.addEventListener('mousemove', e => { const target = e.target.closest('.reminder-diet'); if(target) tooltip.updatePosition(e); });

            populateTables();
            renderAll();
        }
    };
})();

// --- APP INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    LifePlannerApp.storage.loadAllData();
    LifePlannerApp.ui.init();
});
</script>
</body>
</html>
